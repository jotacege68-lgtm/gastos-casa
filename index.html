<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>App Gastos T+J</title>
    
    <link rel="apple-touch-icon" href="https://i.ibb.co/C5f3W1N/logo-casa-tj-azul.png">
    <link rel="icon" type="image/png" href="https://i.ibb.co/C5f3W1N/logo-casa-tj-azul.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        :root {
            /* Paleta Mejorada */
            --juan: #3b82f6;
            --juan-light: #60a5fa;
            --juan-dark: #2563eb;
            --tania: #ec4899;
            --tania-light: #f472b6;
            --tania-dark: #db2777;
            --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --header-h: 75px;
            --radius: 20px;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 20px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 30px rgba(0,0,0,0.16);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f0f4f8;
            margin: 0; 
            padding-top: calc(var(--header-h) + 20px); 
            color: var(--text-main); 
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        /* NavegaciÃ³n */
        .tabs { 
            position: fixed; 
            top: 0; 
            width: 100%; 
            background: var(--bg);
            display: flex; 
            height: var(--header-h); 
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            z-index: 1000; 
            overflow-x: auto; 
            scrollbar-width: none;
            backdrop-filter: blur(10px);
        }
        .tabs::-webkit-scrollbar { display: none; }

        .tab-btn { 
            flex: 1; 
            min-width: 85px; 
            border: none; 
            background: transparent;
            font-size: 10px; 
            font-weight: 700; 
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase; 
            cursor: pointer; 
            padding: 10px 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            position: relative;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 80%;
            height: 3px;
            background: white;
            border-radius: 3px 3px 0 0;
            transition: transform 0.3s ease;
        }

        .tab-btn.active { color: #ffffff !important; background: rgba(255, 255, 255, 0.15); }
        .tab-btn.active::before { transform: translateX(-50%) scaleX(1); }

        /* Contenedores */
        .container { 
            padding: 16px; 
            display: none; 
            max-width: 500px; 
            margin: auto; 
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .container.active { display: block; }

        /* Tarjetas */
        .card { 
            background: var(--card-bg); 
            padding: 24px; 
            border-radius: var(--radius); 
            margin-bottom: 16px; 
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
        }

        .row { display: flex; gap: 10px; margin-bottom: 5px; }
        .row div { flex: 1; }

        /* Formularios */
        label { display: block; margin-bottom: 8px; font-size: 12px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        select, input { 
            width: 100%; padding: 16px; margin-bottom: 16px; border: 2px solid #e2e8f0; 
            border-radius: 14px; font-size: 16px; color: var(--text-main); background: #f8fafc;
            transition: all 0.3s ease; font-weight: 500;
        }
        select:focus, input:focus { outline: none; border-color: var(--juan); background: #fff; }

        .nota-input { border-color: #fbbf24; background: #fffbeb; }

        /* Botones */
        button { 
            width: 100%; padding: 18px; margin-bottom: 12px; border: none; border-radius: 16px; 
            font-weight: 800; font-size: 15px; cursor: pointer; text-transform: uppercase;
            transition: all 0.2s ease;
        }
        button:active { transform: scale(0.97); }

        .btn-juan { background: linear-gradient(135deg, var(--juan-light) 0%, var(--juan-dark) 100%); color: white; box-shadow: 0 6px 15px rgba(59, 130, 246, 0.3); }
        .btn-tania { background: linear-gradient(135deg, var(--tania-light) 0%, var(--tania-dark) 100%); color: white; box-shadow: 0 6px 15px rgba(236, 72, 153, 0.3); }
        .btn-cerrar { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; box-shadow: 0 6px 15px rgba(16, 185, 129, 0.3); }

        /* Historial */
        .historial-item { 
            padding: 18px; background: white; border-radius: 16px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: var(--shadow-sm); border: 1px solid #f1f5f9;
        }
        .item-jc { border-left: 5px solid #8b5cf6 !important; background: #f5f3ff !important; }
        .item-pagador { font-size: 10px; font-weight: 800; color: #475569; background: #e2e8f0; padding: 4px 10px; border-radius: 20px; }
        .item-nota { font-size: 12px; color: #92400e; background: #fef3c7; padding: 4px 8px; border-radius: 6px; display: inline-block; margin: 4px 0; }

        /* Totales y Balances */
        .total-filtro { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: #fbbf24; padding: 24px; border-radius: var(--radius); font-weight: 900; font-size: 26px; text-align: center; margin-bottom: 20px; box-shadow: var(--shadow-lg); }
        .subtotal-seccion { background: #e2e8f0; color: var(--text-main); padding: 10px 15px; font-weight: 800; font-size: 13px; border-radius: 10px; margin: 15px 0 10px 0; display: flex; justify-content: space-between; }
        
        .nav-historial, .nav-balance { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: white; padding: 12px; border-radius: 16px; box-shadow: var(--shadow-sm); }
        .btn-nav { background: #f1f5f9; padding: 10px 20px; border-radius: 10px; width: auto; font-size: 18px; margin: 0; }

        .balance-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px dashed #e2e8f0; }
        .resultado { margin-top: 20px; padding: 20px; border-radius: 16px; text-align: center; font-weight: 900; font-size: 18px; }
        .debe-juan { background: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5; }
        .debe-tania { background: #fce7f3; color: #9d174d; border: 1px solid #f9a8d4; }
        
        .btn-del { background: #fee2e2; color: #ef4444; width: auto; padding: 8px 12px; font-size: 12px; margin: 0; }
    </style>
</head>
<body>

<nav class="tabs">
    <button class="tab-btn active" onclick="showTab('DIARIOS', this)">DIARIO</button>
    <button class="tab-btn" onclick="showTab('MENSUALES', this)">MENSUAL</button>
    <button class="tab-btn" onclick="showTab('JC', this)">SOLO JC</button>
    <button class="tab-btn" onclick="showTab('HISTORIAL', this)">HISTORIAL</button>
    <button class="tab-btn" onclick="showTab('BALANCE', this)">BALANCE</button>
    <button class="tab-btn" onclick="showTab('RESUMENES', this)">REPORTES</button>
</nav>

<div id="DIARIOS" class="container active">
    <div class="card">
        <label>MES DE CARGA</label>
        <div class="row"><div><select id="mes-diarios"></select></div><div><select id="anio-diarios"></select></div></div>
        <label>RUBRO DIARIO (50/50)</label>
        <select id="select-diarios" onchange="toggleNota('diarios')"></select>
        <input type="text" id="nota-diarios" class="nota-input" placeholder="DETALLE (Opcional)" style="display:none">
        <input type="number" id="monto-diarios" inputmode="decimal" placeholder="MONTO $">
        <button class="btn-juan" onclick="guardarGasto('DIARIOS', 'JUAN')">PAGÃ“ JUAN</button>
        <button class="btn-tania" onclick="guardarGasto('DIARIOS', 'TANIA')">PAGÃ“ TANIA</button>
    </div>
</div>

<div id="MENSUALES" class="container">
    <div class="card">
        <label>MES DE CARGA</label>
        <div class="row"><div><select id="mes-mensuales"></select></div><div><select id="anio-mensuales"></select></div></div>
        <label>RUBRO MENSUAL (50/50)</label>
        <select id="select-mensuales" onchange="toggleNota('mensuales')"></select>
        <input type="text" id="nota-mensuales" class="nota-input" placeholder="DETALLE" style="display:none">
        <label>CUOTAS</label>
        <input type="number" id="cuotas-mensuales" value="1" min="1" max="24">
        <input type="number" id="monto-mensuales" inputmode="decimal" placeholder="MONTO POR MES $">
        <button class="btn-juan" onclick="guardarGasto('MENSUALES', 'JUAN')">PAGÃ“ JUAN</button>
        <button class="btn-tania" onclick="guardarGasto('MENSUALES', 'TANIA')">PAGÃ“ TANIA</button>
    </div>
</div>

<div id="JC" class="container">
    <div class="card">
        <label>MES DE CARGA</label>
        <div class="row"><div><select id="mes-jc"></select></div><div><select id="anio-jc"></select></div></div>
        <label>RUBRO JC (DEUDA JUAN)</label>
        <select id="select-jc" onchange="toggleNota('jc')"></select>
        <input type="text" id="nota-jc" class="nota-input" placeholder="DETALLE" style="display:none">
        <label>CUOTAS</label>
        <input type="number" id="cuotas-jc" value="1" min="1" max="24">
        <input type="number" id="monto-jc" inputmode="decimal" placeholder="MONTO POR MES $">
        <button class="btn-tania" onclick="guardarGasto('JC', 'TANIA')">PAGÃ“ TANIA</button>
    </div>
</div>

<div id="HISTORIAL" class="container">
    <div class="card">
        <label>FILTRAR RUBRO</label>
        <select id="filtro-rubro" onchange="cargarHistorial()">
            <option value="FILTRO_CASA">GASTOS CASA (DIARIO+MENSUALES)</option>
            <option value="FILTRO_JUAN">PAGÃ“ JUAN (TODO)</option>
            <option value="FILTRO_TANIA">PAGÃ“ TANIA (TODO)</option>
            <option value="FILTRO_COMIDA">GASTOS COMIDA</option>
            <option value="FILTRO_MENSUALES">SOLO LISTA MENSUAL</option>
            <option value="FILTRO_JC">SOLO LISTA JC</option>
        </select>
    </div>
    <div class="nav-historial"><button class="btn-nav" onclick="cambiarMesHistorial(-1)">â—€</button><h3 id="titulo-mes-historial" style="margin:0">MES</h3><button class="btn-nav" onclick="cambiarMesHistorial(1)">â–¶</button></div>
    <div id="total-acumulado" class="total-filtro">$0</div>
    <div id="lista-historial"></div>
</div>

<div id="BALANCE" class="container">
    <div class="nav-balance"><button class="btn-nav" onclick="cambiarMesBalance(-1)">â—€</button><h3 id="titulo-mes-balance" style="margin:0">MES</h3><button class="btn-nav" onclick="cambiarMesBalance(1)">â–¶</button></div>
    <div class="card" id="resumen-balance"></div>
    <button style="background: #64748b; color: white;" onclick="calcularBalance()">ðŸ”„ ACTUALIZAR</button>
    <button class="btn-cerrar" onclick="cerrarMes()">ðŸ”’ GUARDAR CIERRE DE MES</button>
</div>

<div id="RESUMENES" class="container">
    <h3 style="text-align:center; color:white">CIERRES GUARDADOS</h3>
    <div id="lista-cierres"></div>
</div>

<script>
    // ConfiguraciÃ³n Firebase (la tuya original)
    const firebaseConfig = {
      apiKey: "AIzaSyBDlHjKXf33pCEznyLAmFrTDXVPevrHe9Q",
      authDomain: "gastoscasa-d8bc2.firebaseapp.com",
      databaseURL: "https://gastoscasa-d8bc2-default-rtdb.firebaseio.com",
      projectId: "gastoscasa-d8bc2",
      storageBucket: "gastoscasa-d8bc2.firebasestorage.app",
      messagingSenderId: "749635992986",
      appId: "1:749635992986:web:7916d888f54eb5c3ab0e23"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ServerValue = firebase.database.ServerValue;
    
    let fechaBalanceView = new Date();
    let fechaHistorialView = new Date();
    let balanceActual = {};
    const mesesNombres = ["ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"];

    const listas = {
        diarios: ["AGUA", "AUTO GASTOS", "AVICOLA", "BOLSAS", "CARNICERIA", "CASA VARIOS", "COMBUSTIBLE", "COMIDAS AFUERA", "DENTISTA", "EMPANADAS", "FARMACIA", "FCA. PASTAS", "FERIA PAPEL/CAFE", "FERIA VARIOS", "FERIA VERDURA", "FERRETERIA", "GASTOS ARTIGAS", "GATA COMIDA-PIEDRAS", "LA MOLIENDA", "LAVANDERIA", "PANADERIA", "PANADERIA S/G", "PEAJES", "PESCADERIA", "PIZZA", "PROPINAS", "REGALOS", "SUPERGAS", "SUPERMERCADO", "VARIOS", "VERDULERIA", "VETERINARIA EXTRAS"],
        mensuales: ["A.N.V Juan", "A.N.V. Tania", "ABERTURAS", "CASA VARIOS", "ELECTRICIDAD", "ESPAÃ‘OLA MOVIL", "GASTOS COMUNES DOLARES", "GASTOS COMUNES PESOS", "HBO", "INTERNET", "NETFLIX", "OLLA LEO FA", "SERVICIO FUNEBRE", "VARIOS", "VETERINARIA", "TARJETA BROU REC.", "TARJETA ITAU", "TARJETA OCA", "MANTENIMIENTO AUTO", "CONTRIBUCION INMOBILIARIA", "IMP. PRIMARIA", "IMP. PUERTA", "PATENTE RODADOS", "SEGURO CASA Y AUTO"],
        jc: ["EL TUNEL", "LA MOLIENDA", "CLUB AEBU", "MOVILES", "MEDICAMENTOS ESP.", "GASTOS OCA", "GASTOS ITAU", "GASTOS SANTANDER"]
    };

    function toggleNota(tipo) {
        const item = document.getElementById(`select-${tipo}`).value;
        const rubrosConNota = ["CASA VARIOS", "REGALOS", "COMIDAS AFUERA", "VARIOS", "GASTOS OCA", "GASTOS ITAU", "GASTOS SANTANDER"];
        const inputNota = document.getElementById(`nota-${tipo}`);
        if(inputNota) inputNota.style.display = rubrosConNota.includes(item) ? "block" : "none";
    }

    function cargarListas() {
        const hoy = new Date();
        ['diarios','mensuales','jc'].forEach(tab => {
            const mesSel = document.getElementById(`mes-${tab}`);
            const anioSel = document.getElementById(`anio-${tab}`);
            mesesNombres.forEach((m, idx) => {
                const opt = document.createElement('option'); opt.value = idx + 1; opt.innerText = m;
                if(idx === hoy.getMonth()) opt.selected = true;
                mesSel.appendChild(opt);
            });
            for(let a = 2025; a <= 2027; a++) {
                const opt = document.createElement('option'); opt.value = a; opt.innerText = a;
                if(a === hoy.getFullYear()) opt.selected = true;
                anioSel.appendChild(opt);
            }
        });
        const comboHistorial = document.getElementById('filtro-rubro');
        [...listas.diarios, ...listas.mensuales, ...listas.jc].sort().forEach(i => {
            const opt = document.createElement('option'); opt.value = i; opt.innerText = i; comboHistorial.appendChild(opt);
        });
        listas.diarios.sort().forEach(i => document.getElementById('select-diarios').innerHTML += `<option value="${i}">${i}</option>`);
        listas.mensuales.sort().forEach(i => document.getElementById('select-mensuales').innerHTML += `<option value="${i}">${i}</option>`);
        listas.jc.sort().forEach(i => document.getElementById('select-jc').innerHTML += `<option value="${i}">${i}</option>`);
    }

    async function guardarGasto(tipo, pagador) {
        const tab = tipo.toLowerCase();
        const item = document.getElementById(`select-${tab}`).value;
        const notaInput = document.getElementById(`nota-${tab}`);
        const nota = (notaInput && notaInput.style.display !== 'none') ? notaInput.value : "";
        const monto = parseFloat(document.getElementById(`monto-${tab}`).value);
        let cuotas = (tipo === 'MENSUALES' || tipo === 'JC') ? (parseInt(document.getElementById(`cuotas-${tab}`).value) || 1) : 1;
        const mesElegido = parseInt(document.getElementById(`mes-${tab}`).value);
        const anioElegido = parseInt(document.getElementById(`anio-${tab}`).value);
        
        if (!monto || monto <= 0) return alert("MONTO INVÃLIDO");
        
        const promesas = [];
        for(let i = 0; i < cuotas; i++) {
            let fF = new Date(anioElegido, mesElegido - 1 + i, 15);
            const mesAnio = `${fF.getMonth() + 1}-${fF.getFullYear()}`;
            const nF = cuotas > 1 ? `${nota} (${i+1}/${cuotas})`.trim() : nota;
            promesas.push(db.ref(`gastos_global`).push({ 
                tipo, item, nota: nF, monto, pagador, 
                fecha: fF.toISOString().split('T')[0], 
                mesAnio, timestamp: ServerValue.TIMESTAMP 
            }));
        }
        Promise.all(promesas).then(() => { 
            alert("âœ… GUARDADO"); 
            document.getElementById(`monto-${tab}`).value = ""; 
            if(notaInput) notaInput.style.display = "none"; 
            refrescarVistas(); 
        });
    }

    function refrescarVistas() {
        if(document.getElementById('HISTORIAL').classList.contains('active')) cargarHistorial();
        if(document.getElementById('BALANCE').classList.contains('active')) calcularBalance();
    }

    function cambiarMesHistorial(n) { fechaHistorialView.setMonth(fechaHistorialView.getMonth() + n); refrescarVistas(); }

    function cargarHistorial() {
        const filtro = document.getElementById('filtro-rubro').value;
        const mesAnio = `${fechaHistorialView.getMonth() + 1}-${fechaHistorialView.getFullYear()}`;
        document.getElementById('titulo-mes-historial').innerText = `${mesesNombres[fechaHistorialView.getMonth()]} ${fechaHistorialView.getFullYear()}`;
        
        db.ref(`gastos_global`).orderByChild('mesAnio').equalTo(mesAnio).once('value', (s) => {
            let gastos = []; s.forEach(c => { let g = c.val(); g.id = c.key; gastos.push(g); });
            let html = ""; let totalGeneral = 0;

            if (filtro === 'FILTRO_JUAN' || filtro === 'FILTRO_TANIA') {
                const persona = filtro === 'FILTRO_JUAN' ? 'JUAN' : 'TANIA';
                const filtrados = gastos.filter(g => g.pagador === persona);
                html = filtrados.map(g => itemHtml(g)).join('');
                totalGeneral = filtrados.reduce((a,b)=>a+b.monto,0);
            } else if (filtro === 'FILTRO_COMIDA') {
                const rubrosComida = ["CARNICERIA", "SUPERMERCADO", "AVICOLA", "VERDULERIA", "FERIA VERDURA", "PIZZA", "EMPANADAS", "PESCADERIA", "FCA. PASTAS", "COMIDAS AFUERA", "PANADERIA", "PANADERIA S/G"];
                const comida = gastos.filter(g => rubrosComida.includes(g.item));
                html = comida.map(g => itemHtml(g)).join('');
                totalGeneral = comida.reduce((a, b) => a + b.monto, 0);
            } else if (filtro === 'FILTRO_MENSUALES') {
                const mens = gastos.filter(g => g.tipo === 'MENSUALES');
                html = mens.map(g => itemHtml(g)).join('');
                totalGeneral = mens.reduce((a, b) => a + b.monto, 0);
            } else {
                gastos.forEach(g => { 
                    if ((filtro === 'FILTRO_JC' && g.tipo === 'JC') || 
                        (filtro === 'FILTRO_CASA' && (g.tipo === 'DIARIOS' || g.tipo === 'MENSUALES')) || 
                        (g.item === filtro)) { 
                        html += itemHtml(g); totalGeneral += g.monto; 
                    } 
                });
            }
            document.getElementById('lista-historial').innerHTML = html;
            document.getElementById('total-acumulado').innerText = `$${totalGeneral.toFixed(0)}`;
        });
    }

    function itemHtml(g) {
        return `<div class="historial-item ${g.tipo === 'JC' ? 'item-jc' : ''}">
            <div>
                <small>${g.fecha.split('-')[2]}/${g.fecha.split('-')[1]}</small><br>
                <b>${g.item}</b><br>
                ${g.nota ? `<span class="item-nota">${g.nota}</span><br>` : ''}
                <span class="item-pagador">${g.tipo === 'JC' ? 'JC' : 'PAGÃ“: ' + g.pagador}</span>
            </div>
            <div style="text-align:right">
                <b>$${g.monto.toFixed(0)}</b><br>
                <button class="btn-del" onclick="eliminarGasto('${g.id}')">ELIMINAR</button>
            </div>
        </div>`;
    }

    function eliminarGasto(id) { if(confirm("Â¿Borrar gasto?")) db.ref(`gastos_global/${id}`).remove().then(()=>refrescarVistas()); }

    function cambiarMesBalance(n) { fechaBalanceView.setMonth(fechaBalanceView.getMonth() + n); refrescarVistas(); }

    function calcularBalance() {
        const mesAnio = `${fechaBalanceView.getMonth() + 1}-${fechaBalanceView.getFullYear()}`;
        document.getElementById('titulo-mes-balance').innerText = `${mesesNombres[fechaBalanceView.getMonth()]} ${fechaBalanceView.getFullYear()}`;
        db.ref(`gastos_global`).orderByChild('mesAnio').equalTo(mesAnio).once('value', (s) => {
            let j50 = 0, t50 = 0, totalJC = 0;
            s.forEach(c => { 
                const g = c.val(); 
                if (g.tipo === 'JC') totalJC += g.monto; 
                else if (g.pagador === 'JUAN') j50 += g.monto; 
                else if (g.pagador === 'TANIA') t50 += g.monto; 
            });
            const debe = ((j50 + t50) / 2 - j50) + totalJC;
            balanceActual = { j50, t50, totalJC, deudaJuan: debe, mesAnio };
            document.getElementById('resumen-balance').innerHTML = `
                <div class="balance-item"><span class="label">Juan pagÃ³ (50/50):</span> <span class="value">$${j50.toFixed(0)}</span></div>
                <div class="balance-item"><span class="label">Tania pagÃ³ (50/50):</span> <span class="value">$${t50.toFixed(0)}</span></div>
                <div class="balance-item"><span class="label">Total JC (100% Juan):</span> <span class="value">$${totalJC.toFixed(0)}</span></div>
                <div class="resultado ${debe > 0 ? 'debe-juan' : 'debe-tania'}">
                    ${debe > 0 ? `JUAN DEBE A TANIA: $${debe.toFixed(0)}` : `TANIA DEBE A JUAN: $${Math.abs(debe).toFixed(0)}`}
                </div>`;
        });
    }

    function cerrarMes() { if(confirm("Â¿Guardar este cierre?")) db.ref(`cierres_mensuales/${balanceActual.mesAnio}`).set({ ...balanceActual, fechaCierre: new Date().toISOString() }).then(() => alert("ðŸ”’ Cierre Guardado")); }

    function cargarCierres() {
        db.ref(`cierres_mensuales`).once('value', (s) => {
            let cierresArray = []; s.forEach(c => { cierresArray.push(c.val()); });
            let html = "";
            cierresArray.reverse().forEach(r => {
                const p = r.mesAnio.split('-'); const etiquetaMes = `${mesesNombres[parseInt(p[0])-1]} ${p[1]}`;
                html += `<div class="card">
                    <b style="color:var(--juan-dark)">${etiquetaMes}</b><br>
                    <small>Juan: $${r.j50.toFixed(0)} | Tania: $${r.t50.toFixed(0)} | JC: $${r.totalJC.toFixed(0)}</small>
                    <div class="resultado ${r.deudaJuan > 0 ? 'debe-juan' : 'debe-tania'}" style="font-size:14px; padding:10px; margin-top:10px">
                        ${r.deudaJuan > 0 ? 'JUAN DEBE' : 'TANIA DEBE'}: $${Math.abs(r.deudaJuan).toFixed(0)}
                    </div>
                </div>`;
            });
            document.getElementById('lista-cierres').innerHTML = html;
        });
    }

    function showTab(id, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active'); 
        btn.classList.add('active'); 
        refrescarVistas();
        if(id === 'RESUMENES') cargarCierres();
    }

    window.onload = () => { cargarListas(); refrescarVistas(); };
</script>

</body>
</html>

