<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>App Gastos T+J</title>
    
    <link rel="apple-touch-icon" href="https://i.ibb.co/C5f3W1N/logo-casa-tj-azul.png">
    <link rel="icon" type="image/png" href="https://i.ibb.co/C5f3W1N/logo-casa-tj-azul.png">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e293b">

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --juan: #3b82f6;
            --juan-light: #60a5fa;
            --juan-dark: #2563eb;
            --tania: #ec4899;
            --tania-light: #f472b6;
            --tania-dark: #db2777;
            --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --header-h: 75px;
            --radius: 20px;
            --shadow-md: 0 4px 20px rgba(0,0,0,0.12);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f0f4f8; margin: 0; padding-top: calc(var(--header-h) + 20px); 
            color: var(--text-main); min-height: 100vh;
        }

        .tabs { 
            position: fixed; top: 0; width: 100%; background: var(--bg);
            display: flex; height: var(--header-h); z-index: 1000; overflow-x: auto; 
            scrollbar-width: none; backdrop-filter: blur(10px);
        }
        .tabs::-webkit-scrollbar { display: none; }

        .tab-btn { 
            flex: 1; min-width: 90px; border: none; background: transparent;
            font-size: 11px; font-weight: 700; color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase; cursor: pointer; padding: 10px 8px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: all 0.3s ease; position: relative;
        }

        .tab-btn.active { color: #ffffff !important; background: rgba(255, 255, 255, 0.15); }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 80%; height: 3px; background: white; border-radius: 3px 3px 0 0;
        }

        .container { padding: 16px; display: none; max-width: 500px; margin: auto; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .container.active { display: block; }

        .card { 
            background: var(--card-bg); padding: 24px; border-radius: var(--radius); 
            margin-bottom: 16px; box-shadow: var(--shadow-md); border: 1px solid rgba(0,0,0,0.05);
        }

        label { display: block; margin-bottom: 10px; font-size: 13px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; }
        select, input { 
            width: 100%; padding: 18px 16px; margin-bottom: 16px; border: 2px solid #e2e8f0; 
            border-radius: 14px; font-size: 16px; color: var(--text-main); background: #f8fafc;
        }

        .row { display: flex; gap: 10px; }
        .row div { flex: 1; }

        button { 
            width: 100%; padding: 20px; margin-bottom: 14px; border: none; border-radius: 16px; 
            font-weight: 800; font-size: 16px; cursor: pointer; text-transform: uppercase;
        }
        .btn-juan { background: linear-gradient(135deg, var(--juan-light) 0%, var(--juan-dark) 100%); color: white; }
        .btn-tania { background: linear-gradient(135deg, var(--tania-light) 0%, var(--tania-dark) 100%); color: white; }
        .btn-cerrar { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }

        .historial-item { padding: 18px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
        .item-pendiente { border-left: 5px solid #cbd5e1 !important; background: #f8fafc !important; opacity: 0.6; }
        .item-jc { border-left: 5px solid #8b5cf6 !important; background: #f5f3ff !important; }
        .item-pagador { font-size: 10px; font-weight: 800; color: #475569; background: #e2e8f0; padding: 6px 12px; border-radius: 20px; }
        .item-nota { font-size: 13px; color: #92400e; background: #fef3c7; padding: 6px 12px; border-radius: 8px; display: inline-block; margin-top: 6px; }

        .total-filtro { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: #fbbf24; padding: 28px; border-radius: var(--radius); font-weight: 900; font-size: 28px; text-align: center; margin-bottom: 24px; }
        .subtotal-seccion { background: #f1f5f9; color: var(--text-main); padding: 14px 18px; font-weight: 800; font-size: 14px; border-radius: 12px; margin: 18px 0 10px 0; border-left: 5px solid #cbd5e1; }
        
        .nav-historial, .nav-balance { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; background: white; padding: 14px; border-radius: 16px; }
        .btn-nav { background: #f1f5f9; color: var(--text-main); padding: 14px 24px; border-radius: 12px; width: auto; font-weight: 700; }

        .balance-item { display: flex; justify-content: space-between; padding: 16px 0; border-bottom: 1px dashed #e2e8f0; }
        .resultado { margin-top: 24px; padding: 24px; border-radius: 16px; text-align: center; font-weight: 900; font-size: 22px; }
        .debe-juan { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #b91c1c; border: 2px solid #fca5a5; }
        .debe-tania { background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); color: #9d174d; border: 2px solid #f9a8d4; }
    </style>
</head>
<body>

<nav class="tabs">
    <button class="tab-btn active" onclick="showTab('DIARIOS', this)">DIARIO</button>
    <button class="tab-btn" onclick="showTab('MENSUALES', this)">MENSUAL</button>
    <button class="tab-btn" onclick="showTab('JC', this)">SOLO JC</button>
    <button class="tab-btn" onclick="showTab('HISTORIAL', this)">HISTORIAL</button>
    <button class="tab-btn" onclick="showTab('BALANCE', this)">BALANCE</button>
    <button class="tab-btn" onclick="showTab('RESUMENES', this)">REPORTES</button>
</nav>

<div id="DIARIOS" class="container active">
    <div class="card">
        <label>MES DE CARGA</label>
        <div class="row"><div><select id="mes-diarios"></select></div><div><select id="anio-diarios"></select></div></div>
        <label>RUBRO DIARIO (50/50)</label>
        <select id="select-diarios" onchange="toggleNota('diarios')"></select>
        <input type="text" id="nota-diarios" class="nota-input" placeholder="DETALLE / CONCEPTO" style="display:none">
        <input type="number" id="monto-diarios" inputmode="decimal" placeholder="MONTO $">
        <button class="btn-juan" onclick="guardarGasto('DIARIOS', 'JUAN')">PAGÃ“ JUAN</button>
        <button class="btn-tania" onclick="guardarGasto('DIARIOS', 'TANIA')">PAGÃ“ TANIA</button>
    </div>
</div>

<div id="MENSUALES" class="container">
    <div class="card">
        <label>MES DE CARGA</label>
        <div class="row"><div><select id="mes-mensuales"></select></div><div><select id="anio-mensuales"></select></div></div>
        <label>RUBRO MENSUAL (50/50)</label>
        <select id="select-mensuales" onchange="toggleNota('mensuales')"></select>
        <input type="text" id="nota-mensuales" class="nota-input" placeholder="DETALLE / CONCEPTO" style="display:none">
        <label>CUOTAS</label>
        <input type="number" id="cuotas-mensuales" value="1" min="1" max="24">
        <input type="number" id="monto-mensuales" inputmode="decimal" placeholder="MONTO POR MES $">
        <button class="btn-juan" onclick="guardarGasto('MENSUALES', 'JUAN')">PAGÃ“ JUAN</button>
        <button class="btn-tania" onclick="guardarGasto('MENSUALES', 'TANIA')">PAGÃ“ TANIA</button>
    </div>
</div>

<div id="JC" class="container">
    <div class="card">
        <label>MES DE CARGA</label>
        <div class="row"><div><select id="mes-jc"></select></div><div><select id="anio-jc"></select></div></div>
        <label>RUBRO JC (DEUDA JUAN)</label>
        <select id="select-jc" onchange="toggleNota('jc')"></select>
        <input type="text" id="nota-jc" class="nota-input" placeholder="DETALLE TARJETA" style="display:none">
        <label>CUOTAS</label>
        <input type="number" id="cuotas-jc" value="1" min="1" max="24">
        <input type="number" id="monto-jc" inputmode="decimal" placeholder="MONTO POR MES $">
        <button class="btn-tania" onclick="guardarGasto('JC', 'TANIA')">PAGÃ“ TANIA</button>
    </div>
</div>

<div id="HISTORIAL" class="container">
    <div class="card">
        <label>REPORTE POR PERSONA O RUBRO</label>
        <select id="filtro-rubro" onchange="cargarHistorial()">
            <option value="FILTRO_CASA">GASTOS CASA (DIARIO+MENSUALES)</option>
            <option value="FILTRO_JUAN">PAGÃ“ JUAN (DIARIO + MENSUAL)</option>
            <option value="FILTRO_TANIA">PAGÃ“ TANIA (DIARIO + MENSUAL)</option>
            <option value="FILTRO_COMIDA">GASTOS COMIDA (VARIOS)</option>
            <option value="FILTRO_MENSUALES">SOLO LISTA MENSUAL</option>
            <option value="FILTRO_JC">SOLO LISTA JC</option>
        </select>
    </div>
    <div class="nav-historial"><button class="btn-nav" onclick="cambiarMesHistorial(-1)">â—€</button><h3 id="titulo-mes-historial" style="margin:0">MES</h3><button class="btn-nav" onclick="cambiarMesHistorial(1)">â–¶</button></div>
    <div id="total-acumulado" class="total-filtro">$0</div>
    <div id="lista-historial"></div>
</div>

<div id="BALANCE" class="container">
    <div class="nav-balance"><button class="btn-nav" onclick="cambiarMesBalance(-1)">â—€</button><h3 id="titulo-mes-balance" style="margin:0">MES</h3><button class="btn-nav" onclick="cambiarMesBalance(1)">â–¶</button></div>
    <div class="card" id="resumen-balance"></div>
    <button style="background: #64748b; color: white;" onclick="calcularBalance()">ðŸ”„ ACTUALIZAR</button>
    <button class="btn-cerrar" onclick="cerrarMes()">ðŸ”’ GUARDAR CIERRE DE MES</button>
</div>

<div id="RESUMENES" class="container"><div id="lista-cierres"></div></div>

<script>
    // ConfiguraciÃ³n del Manifesto DinÃ¡mico para PWA (Con tu Logo)
    const manifest = {
      "name": "Gastos T+J", "short_name": "T+J", "start_url": ".", "display": "standalone", "background_color": "#ffffff", "theme_color": "#667eea",
      "icons": [
        { "src": "https://i.ibb.co/C5f3W1N/logo-casa-tj-azul.png", "sizes": "192x192", "type": "image/png" },
        { "src": "https://i.ibb.co/C5f3W1N/logo-casa-tj-azul.png", "sizes": "512x512", "type": "image/png" }
      ]
    };
    const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
    const manifestURL = URL.createObjectURL(blob);
    document.querySelector('head').innerHTML += `<link rel="manifest" href="${manifestURL}">`;

    const firebaseConfig = {
      apiKey: "AIzaSyBDlHjKXf33pCEznyLAmFrTDXVPevrHe9Q",
      authDomain: "gastoscasa-d8bc2.firebaseapp.com",
      databaseURL: "https://gastoscasa-d8bc2-default-rtdb.firebaseio.com",
      projectId: "gastoscasa-d8bc2",
      storageBucket: "gastoscasa-d8bc2.firebasestorage.app",
      messagingSenderId: "749635992986",
      appId: "1:749635992986:web:7916d888f54eb5c3ab0e23",
      measurementId: "G-PHML1K224T"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ServerValue = firebase.database.ServerValue;
    
    let fechaBalanceView = new Date();
    let fechaHistorialView = new Date();
    let balanceActual = {};
    const mesesNombres = ["ENERO", "FEBRERO", "MARZO", "ABRIL", "MAYO", "JUNIO", "JULIO", "AGOSTO", "SEPTIEMBRE", "OCTUBRE", "NOVIEMBRE", "DICIEMBRE"];

    const listas = {
        diarios: ["AGUA", "AUTO GASTOS", "AVICOLA", "BOLSAS", "CARNICERIA", "CASA VARIOS", "COMBUSTIBLE", "COMIDAS AFUERA", "DENTISTA", "EMPANADAS", "FARMACIA", "FCA. PASTAS", "FERIA PAPEL/CAFE", "FERIA VARIOS", "FERIA VERDURA", "FERRETERIA", "GASTOS ARTIGAS", "GATA COMIDA-PIEDRAS", "LA MOLIENDA", "LAVANDERIA", "PANADERIA", "PANADERIA S/G", "PEAJES", "PESCADERIA", "PIZZA", "PROPINAS", "REGALOS", "SUPERGAS", "SUPERMERCADO", "VARIOS", "VERDULERIA", "VETERINARIA EXTRAS"],
        mensuales: ["A.N.V Juan", "A.N.V. Tania", "ABERTURAS", "CASA VARIOS", "ELECTRICIDAD", "ESPAÃ‘OLA MOVIL", "GASTOS COMUNES DOLARES", "GASTOS COMUNES PESOS", "HBO", "INTERNET", "NETFLIX", "OLLA LEO FA", "SERVICIO FUNEBRE", "VARIOS", "VETERINARIA", "TARJETA BROU REC.", "TARJETA ITAU", "TARJETA OCA", "MANTENIMIENTO AUTO", "CONTRIBUCION INMOBILIARIA", "IMP. PRIMARIA", "IMP
